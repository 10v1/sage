From 819e046b0231e9eb7b7c6dda9ab1ba94cf5abccd Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 11 Oct 2023 20:36:35 -0700
Subject: [PATCH 1/5] Remove outdated self-cimports in pyx files

---
 cylp/cy/CyCbcNode.pyx                | 3 ---
 cylp/cy/CyCglCutGeneratorBase.pyx    | 3 ---
 cylp/cy/CyCglTreeInfo.pyx            | 3 ---
 cylp/cy/CyCoinModel.pyx              | 3 ---
 cylp/cy/CyCutGeneratorPythonBase.pyx | 4 ----
 cylp/cy/CyDantzigPivot.pyx           | 2 --
 cylp/cy/CyDualPivotPythonBase.pyx    | 3 ---
 cylp/cy/CyOsiCuts.pyx                | 1 -
 cylp/cy/CyOsiSolverInterface.pyx     | 4 ----
 cylp/cy/CyPivotPythonBase.pyx        | 2 --
 cylp/cy/CyWolfePivot.pyx             | 2 --
 cylp/cy/createCythonInterface.py     | 1 -
 12 files changed, 31 deletions(-)

diff --git a/cylp/cy/CyCbcNode.pyx b/cylp/cy/CyCbcNode.pyx
index a4092d0..d8da84d 100644
--- a/cylp/cy/CyCbcNode.pyx
+++ b/cylp/cy/CyCbcNode.pyx
@@ -1,8 +1,5 @@
 # cython: embedsignature=True
 
-
-cimport CyCbcNode
-
 cdef class CyCbcNode:
     def __cinit__(self):
         self.CppSelf = new CppICbcNode()
diff --git a/cylp/cy/CyCglCutGeneratorBase.pyx b/cylp/cy/CyCglCutGeneratorBase.pyx
index 0bb324f..a2f2054 100644
--- a/cylp/cy/CyCglCutGeneratorBase.pyx
+++ b/cylp/cy/CyCglCutGeneratorBase.pyx
@@ -1,8 +1,5 @@
 # cython: embedsignature=True
 
-cimport CyCglCutGeneratorBase
-from cylp.cy.CyCglCutGeneratorBase import CyCglCutGeneratorBase
-
 cdef void RunGenerateCuts(void *ptr, CppOsiSolverInterface *si,
                                      CppOsiCuts *cs,
                                      CppCglTreeInfo info):
diff --git a/cylp/cy/CyCglTreeInfo.pyx b/cylp/cy/CyCglTreeInfo.pyx
index 5c599bd..7857a02 100644
--- a/cylp/cy/CyCglTreeInfo.pyx
+++ b/cylp/cy/CyCglTreeInfo.pyx
@@ -1,6 +1,3 @@
-
-cimport CyCglTreeInfo
-
 cdef class CyCglTreeInfo:
     'CyCglTreeInfo documentation'
     def __cinit__(self):
diff --git a/cylp/cy/CyCoinModel.pyx b/cylp/cy/CyCoinModel.pyx
index f08b88a..55f038d 100644
--- a/cylp/cy/CyCoinModel.pyx
+++ b/cylp/cy/CyCoinModel.pyx
@@ -1,8 +1,5 @@
 # cython: embedsignature=True
 
-
-from cylp.cy cimport CyCoinModel
-
 cdef class CyCoinModel:
     '''
 
diff --git a/cylp/cy/CyCutGeneratorPythonBase.pyx b/cylp/cy/CyCutGeneratorPythonBase.pyx
index b067f70..48aa44d 100644
--- a/cylp/cy/CyCutGeneratorPythonBase.pyx
+++ b/cylp/cy/CyCutGeneratorPythonBase.pyx
@@ -1,9 +1,5 @@
 # cython: embedsignature=True
 
-
-cimport CyCutGeneratorPythonBase
-
-
 cdef class CyCutGeneratorPythonBase(CyCglCutGeneratorBase):
     def __init__(self, cutGeneratorObject, cyLPModel=None):
         CyCglCutGeneratorBase.__init__(self)
diff --git a/cylp/cy/CyDantzigPivot.pyx b/cylp/cy/CyDantzigPivot.pyx
index 8089ff4..7714019 100644
--- a/cylp/cy/CyDantzigPivot.pyx
+++ b/cylp/cy/CyDantzigPivot.pyx
@@ -3,8 +3,6 @@
 
 import numpy as np
 cimport numpy as np
-cimport CyDantzigPivot
-#cimport CyClpSimplex
 
 # varStatus defined to mimic 'enum ClpSimplex::Status'.
 # But is too slow obviously
diff --git a/cylp/cy/CyDualPivotPythonBase.pyx b/cylp/cy/CyDualPivotPythonBase.pyx
index 89f4ebc..f33d5ae 100644
--- a/cylp/cy/CyDualPivotPythonBase.pyx
+++ b/cylp/cy/CyDualPivotPythonBase.pyx
@@ -1,8 +1,5 @@
 # cython: embedsignature=True
 
-
-cimport CyDualPivotPythonBase
-
 cdef class CyDualPivotPythonBase(CyClpDualRowPivotBase):
     def __init__(self, dualPivotMethodObject):
         CyClpDualRowPivotBase.__init__(self)
diff --git a/cylp/cy/CyOsiCuts.pyx b/cylp/cy/CyOsiCuts.pyx
index 828d32f..f58490f 100644
--- a/cylp/cy/CyOsiCuts.pyx
+++ b/cylp/cy/CyOsiCuts.pyx
@@ -1,6 +1,5 @@
 import scipy
 from scipy.sparse import csr_matrix
-cimport CyOsiCuts
 from cylp.py.modeling.CyLPModel import CyLPModel
 cimport numpy as np
 import numpy as np
diff --git a/cylp/cy/CyOsiSolverInterface.pyx b/cylp/cy/CyOsiSolverInterface.pyx
index b3f0514..5bde926 100644
--- a/cylp/cy/CyOsiSolverInterface.pyx
+++ b/cylp/cy/CyOsiSolverInterface.pyx
@@ -1,7 +1,3 @@
-
-cimport CyOsiSolverInterface
-
-
 cdef extern from *:
     CppOsiClpSolverInterface* dynamic_cast_osi_2_clp "dynamic_cast<OsiClpSolverInterface*>" (CppOsiSolverInterface*)
     CppIClpSimplex* static_cast_clp_2_iclp "static_cast<IClpSimplex*>" (CppClpSimplex*)
diff --git a/cylp/cy/CyPivotPythonBase.pyx b/cylp/cy/CyPivotPythonBase.pyx
index ba6a39f..5394fd1 100644
--- a/cylp/cy/CyPivotPythonBase.pyx
+++ b/cylp/cy/CyPivotPythonBase.pyx
@@ -1,8 +1,6 @@
 # cython: embedsignature=True
 
 
-cimport CyPivotPythonBase
-
 cdef class CyPivotPythonBase(CyClpPrimalColumnPivotBase):
     def __init__(self, pivotMethodObject):
         CyClpPrimalColumnPivotBase.__init__(self)
diff --git a/cylp/cy/CyWolfePivot.pyx b/cylp/cy/CyWolfePivot.pyx
index 74288cb..de1b14f 100644
--- a/cylp/cy/CyWolfePivot.pyx
+++ b/cylp/cy/CyWolfePivot.pyx
@@ -1,8 +1,6 @@
 # cython: embedsignature=True
 
 
-from cylp.cy cimport CyWolfePivot
-
 cdef class CyWolfePivot(CyClpPrimalColumnPivotBase):
 
     cdef pivotColumn(self, CppCoinIndexedVector* cppupdates, CppCoinIndexedVector* cppspareRow1,
diff --git a/cylp/cy/createCythonInterface.py b/cylp/cy/createCythonInterface.py
index 2e284ea..d766d7d 100644
--- a/cylp/cy/createCythonInterface.py
+++ b/cylp/cy/createCythonInterface.py
@@ -34,7 +34,6 @@
 
 #Create the pyx file
 pyxContent = '''
-cimport Cy%s
 
 cdef class Cy%s:
     'Cy%s documentation'

From 87785ac27212cb3bfccd621f538db2a4e8c9792c Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 11 Oct 2023 20:57:37 -0700
Subject: [PATCH 2/5] Use absolute cimports only

---
 cylp/cy/CyClpSimplex.pyx             | 9 ++++-----
 cylp/cy/CyCutGeneratorPythonBase.pxd | 8 ++++----
 cylp/cy/CyDantzigPivot.pxd           | 2 +-
 cylp/cy/CyDualPivotPythonBase.pxd    | 2 +-
 cylp/cy/CyPEPivot.pxd                | 2 +-
 cylp/cy/CyPivotPythonBase.pxd        | 2 +-
 cylp/cy/CyWolfePivot.pxd             | 2 +-
 7 files changed, 13 insertions(+), 14 deletions(-)

diff --git a/cylp/cy/CyClpSimplex.pyx b/cylp/cy/CyClpSimplex.pyx
index c7d5cf2..f6a8bfb 100644
--- a/cylp/cy/CyClpSimplex.pyx
+++ b/cylp/cy/CyClpSimplex.pyx
@@ -15,11 +15,10 @@ import numpy as np
 cimport numpy as np
 from scipy import sparse
 cimport cpython.ref as cpy_ref
-from CyWolfePivot cimport CyWolfePivot
-from CyPEPivot cimport CyPEPivot
-from CyPivotPythonBase cimport CyPivotPythonBase
-from CyDualPivotPythonBase cimport CyDualPivotPythonBase
-from cylp.cy cimport CyClpSimplex
+from cylp.cy.CyWolfePivot cimport CyWolfePivot
+from cylp.cy.CyPEPivot cimport CyPEPivot
+from cylp.cy.CyPivotPythonBase cimport CyPivotPythonBase
+from cylp.cy.CyDualPivotPythonBase cimport CyDualPivotPythonBase
 from cylp.cy cimport CyCoinModel
 from cylp.py.utils.sparseUtil import sparseConcat, csc_matrixPlus
 from cylp.py.modeling.CyLPModel import CyLPVar, CyLPArray, CyLPSolution
diff --git a/cylp/cy/CyCutGeneratorPythonBase.pxd b/cylp/cy/CyCutGeneratorPythonBase.pxd
index 64ec234..25061c1 100644
--- a/cylp/cy/CyCutGeneratorPythonBase.pxd
+++ b/cylp/cy/CyCutGeneratorPythonBase.pxd
@@ -1,7 +1,7 @@
-from CyCglCutGeneratorBase cimport *
-from CyOsiSolverInterface cimport CppOsiSolverInterface, CyOsiSolverInterface
-from CyOsiCuts cimport CppOsiCuts, CyOsiCuts
-from CyCglTreeInfo cimport CppCglTreeInfo, CyCglTreeInfo
+from cylp.cy.CyCglCutGeneratorBase cimport *
+from cylp.cy.CyOsiSolverInterface cimport CppOsiSolverInterface, CyOsiSolverInterface
+from cylp.cy.CyOsiCuts cimport CppOsiCuts, CyOsiCuts
+from cylp.cy.CyCglTreeInfo cimport CppCglTreeInfo, CyCglTreeInfo
 cimport cython.operator.dereference as deref
 from cylp.cy.CyClpSimplex cimport CyClpSimplex, CppIClpSimplex
 from cylp.cy.CyCoinIndexedVector cimport CyCoinIndexedVector
diff --git a/cylp/cy/CyDantzigPivot.pxd b/cylp/cy/CyDantzigPivot.pxd
index d247b0e..bd1a411 100644
--- a/cylp/cy/CyDantzigPivot.pxd
+++ b/cylp/cy/CyDantzigPivot.pxd
@@ -1,4 +1,4 @@
-from CyClpPrimalColumnPivotBase cimport *
+from cylp.cy.CyClpPrimalColumnPivotBase cimport *
 from cylp.cy cimport CyClpSimplex
 from cylp.cy.CyCoinIndexedVector cimport CyCoinIndexedVector
 
diff --git a/cylp/cy/CyDualPivotPythonBase.pxd b/cylp/cy/CyDualPivotPythonBase.pxd
index d4adb7d..99ed8ae 100644
--- a/cylp/cy/CyDualPivotPythonBase.pxd
+++ b/cylp/cy/CyDualPivotPythonBase.pxd
@@ -1,6 +1,6 @@
 import numpy as np
 cimport numpy as np
-from CyClpDualRowPivotBase cimport *
+from cylp.cy.CyClpDualRowPivotBase cimport *
 cimport cython.operator.dereference as deref
 from cylp.cy cimport CyClpSimplex
 from cylp.cy.CyCoinIndexedVector cimport CyCoinIndexedVector
diff --git a/cylp/cy/CyPEPivot.pxd b/cylp/cy/CyPEPivot.pxd
index b8d7bab..9a8d9e9 100644
--- a/cylp/cy/CyPEPivot.pxd
+++ b/cylp/cy/CyPEPivot.pxd
@@ -1,5 +1,5 @@
 cimport cython.operator.dereference as deref
-from CyClpPrimalColumnPivotBase cimport *
+from cylp.cy.CyClpPrimalColumnPivotBase cimport *
 from cylp.cy cimport CyClpSimplex
 from cylp.cy.CyCoinIndexedVector cimport CyCoinIndexedVector
 
diff --git a/cylp/cy/CyPivotPythonBase.pxd b/cylp/cy/CyPivotPythonBase.pxd
index 12d7dc4..3734a6b 100644
--- a/cylp/cy/CyPivotPythonBase.pxd
+++ b/cylp/cy/CyPivotPythonBase.pxd
@@ -1,4 +1,4 @@
-from CyClpPrimalColumnPivotBase cimport *
+from cylp.cy.CyClpPrimalColumnPivotBase cimport *
 cimport cython.operator.dereference as deref
 from cylp.cy.CyClpSimplex cimport CyClpSimplex, CppIClpSimplex
 from cylp.cy.CyCoinIndexedVector cimport CyCoinIndexedVector
diff --git a/cylp/cy/CyWolfePivot.pxd b/cylp/cy/CyWolfePivot.pxd
index 27a700f..27a08e0 100644
--- a/cylp/cy/CyWolfePivot.pxd
+++ b/cylp/cy/CyWolfePivot.pxd
@@ -1,4 +1,4 @@
-from CyClpPrimalColumnPivotBase cimport *
+from cylp.cy.CyClpPrimalColumnPivotBase cimport *
 from cylp.cy cimport CyClpSimplex
 from cylp.cy.CyCoinIndexedVector cimport CyCoinIndexedVector
 

From a0a998d4774620543ba5e872d495b179179fdcc2 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 11 Oct 2023 21:29:43 -0700
Subject: [PATCH 3/5] Remove a duplicate 'cdef cppclass'

---
 cylp/cy/CyCglCutGeneratorBase.pxd | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/cylp/cy/CyCglCutGeneratorBase.pxd b/cylp/cy/CyCglCutGeneratorBase.pxd
index ba0a8dd..d8d4070 100644
--- a/cylp/cy/CyCglCutGeneratorBase.pxd
+++ b/cylp/cy/CyCglCutGeneratorBase.pxd
@@ -16,10 +16,6 @@ cdef extern from "CglCutGenerator.hpp":
     #CppCglCutGenerator* new_CyCglCutGenerator \
     #                                "new ICglCutGenerator" ()
 
-cdef extern from "OsiSolverInterface.hpp":
-    cdef cppclass CppOsiSolverInterface "OsiSolverInterface":
-        pass
-
 cdef extern from "ICglCutGeneratorBase.h":
     #cdef cppclass CoinIndexedVector:
     #   pass

From 2306dfbfd57150d4c13470ffa07eecb10a644b15 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 11 Oct 2023 21:36:10 -0700
Subject: [PATCH 4/5] Do not use cpdef for variables

---
 cylp/cy/CyClpSimplex.pxd        | 4 ++--
 cylp/cy/CyCoinIndexedVector.pxd | 2 +-
 cylp/cy/CyCoinMpsIO.pxd         | 2 +-
 cylp/cy/CyCoinPackedMatrix.pxd  | 2 +-
 4 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/cylp/cy/CyClpSimplex.pxd b/cylp/cy/CyClpSimplex.pxd
index fde2b58..b8b2ad0 100644
--- a/cylp/cy/CyClpSimplex.pxd
+++ b/cylp/cy/CyClpSimplex.pxd
@@ -304,8 +304,8 @@ cdef class CyClpSimplex:
     This is the documentation of CyClpSimpelx in the pyx class
     '''
 
-    cpdef CppIClpSimplex *CppSelf
-    cpdef vars
+    cdef CppIClpSimplex *CppSelf
+    cdef vars
     cdef object varSelCriteria
     cdef CyCoinModel coinModel
     cdef object cyLPModel
diff --git a/cylp/cy/CyCoinIndexedVector.pxd b/cylp/cy/CyCoinIndexedVector.pxd
index 7c2215f..97b550f 100644
--- a/cylp/cy/CyCoinIndexedVector.pxd
+++ b/cylp/cy/CyCoinIndexedVector.pxd
@@ -20,7 +20,7 @@ cdef extern from "ICoinIndexedVector.hpp":
 
 
 cdef class CyCoinIndexedVector:
-    cpdef CppCoinIndexedVector *CppSelf
+    cdef CppCoinIndexedVector *CppSelf
     cpdef reserve(self, n)
     cpdef assign(self, ind, other)
     cdef setCppSelf(self, CppCoinIndexedVector* s)
diff --git a/cylp/cy/CyCoinMpsIO.pxd b/cylp/cy/CyCoinMpsIO.pxd
index 23fcd27..f2ac645 100644
--- a/cylp/cy/CyCoinMpsIO.pxd
+++ b/cylp/cy/CyCoinMpsIO.pxd
@@ -45,7 +45,7 @@ cdef extern from "ICoinMpsIO.hpp":
 
 cdef class CyCoinMpsIO:
     cdef CppICoinMpsIO *CppSelf
-    cpdef Hessian
+    cdef Hessian
 #    cpdef  getColLower(self)
 #    cpdef  getColUpper(self)
 #    cpdef getRowSense(self)
diff --git a/cylp/cy/CyCoinPackedMatrix.pxd b/cylp/cy/CyCoinPackedMatrix.pxd
index 8515921..c1fa0bb 100644
--- a/cylp/cy/CyCoinPackedMatrix.pxd
+++ b/cylp/cy/CyCoinPackedMatrix.pxd
@@ -25,7 +25,7 @@ cdef extern from "ICoinPackedMatrix.hpp":
 
 
 cdef class CyCoinPackedMatrix:
-    cpdef CppCoinPackedMatrix* CppSelf
+    cdef CppCoinPackedMatrix* CppSelf
     #cpdef getIndices(self)
     #cpdef getElements(self)
     #cpdef getNumElements(self)

From 3bbeb732034b7797a3ef218d84230b6513fc264c Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 11 Oct 2023 21:45:33 -0700
Subject: [PATCH 5/5] cylp/cy/CyCbcModel.pxd: Update exception specs for Cython
 3

---
 cylp/cy/CyCbcModel.pxd | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/cylp/cy/CyCbcModel.pxd b/cylp/cy/CyCbcModel.pxd
index 5e43922..f19a50b 100644
--- a/cylp/cy/CyCbcModel.pxd
+++ b/cylp/cy/CyCbcModel.pxd
@@ -10,12 +10,12 @@ cdef extern from "CbcCompareUser.hpp":
     cdef cppclass CppCbcCompareUser "CbcCompareUser":
         pass
     ctypedef int (*runTest_t)(void* instance, CppICbcNode* x,
-                              CppICbcNode* y)
+                              CppICbcNode* y) except? -1
     ctypedef bint (*runNewSolution_t)(void*instance, CppICbcModel* model,
                        double objectiveAtContinuous,
-                       int numberInfeasibilitiesAtContinuous)
+                       int numberInfeasibilitiesAtContinuous) except? -1
     ctypedef int (*runEvery1000Nodes_t)(void* instance,
-                            CppICbcModel* model, int numberNodes)
+                            CppICbcModel* model, int numberNodes) except? -1
     bint equalityTest(CppICbcNode* x, CppICbcNode* y)
 
 
